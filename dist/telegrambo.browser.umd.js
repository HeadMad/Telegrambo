(function(h,_){typeof exports=="object"&&typeof module<"u"?module.exports=_():typeof define=="function"&&define.amd?define(_):(h=typeof globalThis<"u"?globalThis:h||self,h.telegrambo=_())})(this,(function(){"use strict";const h=new Set(["chat_id","from_chat_id","text"]);function _(e){const s={};for(let[r,c]of e)h.has(r)?s[r]=String(c):typeof c=="object"?s[r]=JSON.stringify(c):s[r]=c;return s}function w(e,{timeout:s=3e4,apiUrl:r="https://api.telegram.org"}={}){if(!e||typeof e!="string")throw new Error("Token must be a non-empty string");return async function(d,o={}){if(!d||typeof d!="string")throw new Error("Method must be a non-empty string");const n=`${r}/bot${e}/${d}`,t=Object.entries(o),f=t.some(([l,u])=>m(u)?!0:l==="media"&&Array.isArray(u)?u.some(g=>m(g?.media)):!1)?E(t):x(_(t));return j(n,f,s)}}function m(e){return!e||typeof e!="object"?!1:e instanceof Blob||e instanceof File||e.source&&(e.source instanceof Blob||e.source instanceof File)}function x(e){return{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}}function E(e){const s=new FormData,r=[];let c=0;function d(o,n){if(m(n)){const t=`file${c++}`,i=n instanceof Blob||n instanceof File?n:n.source,f=n.filename||(n instanceof File?n.name:"file");return r.push({name:t,file:i,filename:f}),`attach://${t}`}return o==="media"&&Array.isArray(n)?n.map(t=>{if(t&&typeof t=="object"&&m(t.media)){const i=`file${c++}`,f=t.media instanceof Blob||t.media instanceof File?t.media:t.media.source,l=t.media.filename||(t.media instanceof File?t.media.name:"file");return r.push({name:i,file:f,filename:l}),{...t,media:`attach://${i}`}}return t}):n}for(const[o,n]of e){const t=d(o,n),i=typeof t=="object"&&t!==null?JSON.stringify(t):String(t);s.append(o,i)}for(const{name:o,file:n,filename:t}of r)s.append(o,n,t);return{body:s,headers:{}}}async function j(e,{body:s,headers:r},c){const d=new AbortController,o=setTimeout(()=>d.abort(),c);try{const n=await fetch(e,{method:"POST",headers:r,body:s,signal:d.signal});clearTimeout(o);const t=await n.json();if(t.ok)return t.result;const i=new Error(t.description||"API Error");throw i.code=t.error_code,i}catch(n){throw clearTimeout(o),n.name==="AbortError"?new Error("Request timeout"):n}}const a=new Map;a.set("message",e=>({chat_id:e.chat.id,from_chat_id:e.chat.id,message_id:e.message_id,message_thread_id:e?.message_thread_id,direct_messages_topic_id:e?.direct_messages_topic?.topic_id}));const y=e=>({business_connection_id:e.business_connection_id,chat_id:e.chat.id,message_id:e.message_id});a.set("business_message",y),a.set("edited_business_message",y),a.set("deleted_business_messages",y),a.set("business_connection",e=>({chat_id:e.user_chat_id})),a.set("callback_query",e=>({chat_id:e.message.chat.id,callback_query_id:e.id,message_id:e.message.message_id})),a.set("inline_query",e=>({inline_query_id:e.id})),a.set("channel_post",e=>({chat_id:e.chat.id,message_id:e.message_id})),a.set("poll_answer",e=>({chat_id:"user"in e?e.user.id:e.voter_chat.id})),a.set("chat_join_request",e=>({chat_id:e.from.id})),a.set("chat_boost",e=>({chat_id:e.boost.source.user.id})),a.set("removed_chat_boost",e=>({chat_id:e.source.user.id}));function S(e,s){return a.has(e)?a.get(e)(s):{}}function C(e,s,r){const c=r[s],d=S(s,c);return new Proxy(c,{get(n,t){return t in n?n[t]:t==="update"?r:t==="payload"?d:(i={})=>e(t,{...d,...i})}})}function q(){const e=new Map;return{has:s=>e.has(s),get:s=>e.get(s),add(s,r){e.has(s)?e.get(s).push(r):e.set(s,[r])}}}class p extends Error{constructor(s){super(s),this.name="BotContextErrors"}}function O(e,s={}){const r=q(),c={};c.on=(o,n)=>{typeof o=="function"&&(n=o,o=null);const t={handler:n};return r.add(o,t),{catch(i){t.reject=i}}},c.setUpdate=async o=>{const n=Object.keys(o).find(u=>u!=="update_id"),t=C(e,n,o),i=[];r.has(n)&&i.push(...r.get(n)),r.has(null)&&i.push(...r.get(null));const f=async({handler:u,reject:g})=>{try{return await u(t,n)}catch(b){if(g)try{return await g(b,t,n)}catch(F){return console.error("An error occurred within the .catch() handler itself:",F),b}else return b}};if(s.parallel===!0)return Promise.all(i.map(f));const l=[];for(const u of i)l.push(await f(u));return l};const d=new Proxy(c,{get:(o,n)=>o[n]??((t={})=>e(n,t)),set(o,n,t){if(n in o)throw new p(`Can't rewrite method "${n}"`);if(typeof t!="function")throw new p(`New method "${n}" must be a function`);return o[n]=t(d),!0}});return d}function B(e,s={}){const r=w(e);return O(r,s)}return B}));
//# sourceMappingURL=telegrambo.browser.umd.js.map
